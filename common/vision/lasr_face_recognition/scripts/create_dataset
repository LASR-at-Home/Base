#!/usr/bin/env python3

import sys

if len(sys.argv) < 3:
    print("usage: rosrun lasr_face_recognition create_dataset.py <dataset> <name> [size=20]")
    exit(0)

dataset = sys.argv[1]
name = sys.argv[2]

if len(sys.argv) > 3:
    size = sys.argv[3]
else:
    size = 20

import rospy
import rospkg
from sensor_msgs.msg import Image
import os
import cv2_img
import cv2

DATASET_ROOT = os.path.join(rospkg.RosPack().get_path("lasr_face_recognition"), "datasets")
DATASET_PATH = os.path.join(DATASET_ROOT, dataset, name)
if not os.path.exists(DATASET_PATH):
    os.makedirs(DATASET_PATH)

rospy.init_node("create_dataset")
rospy.loginfo(f"Taking {size} pictures of {name} and saving to {DATASET_PATH}")

for i in range(size):
    img_msg = rospy.wait_for_message("/xtion/rgb/image_raw", Image)
    cv_im = cv2_img.msg_to_cv2_img(img_msg)
    cv2.imwrite(os.path.join(DATASET_PATH), f"{name}_{i+1}.png", cv_im)
    rospy.loginfo(f"Took picutre {i+1}")
    rospy.sleep(rospy.Duration(1.0))
